<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hanzi Creatures - Learn Chinese Characters</title>

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="practice-styles.css">
    <script src="https://unpkg.com/hanzi-writer@3.5.0/dist/hanzi-writer.min.js"></script>
    <script>
        // Check if HanziWriter loaded from CDN
        window.addEventListener('DOMContentLoaded', function() {
            if (typeof HanziWriter === 'undefined') {
                console.error('HanziWriter failed to load from CDN');
                document.body.innerHTML = '<div style="text-align:center;padding:50px;font-family:Arial;color:#333;"><h2>âš ï¸ Loading Error</h2><p>Failed to load the character writing library from CDN.<br>Please check your internet connection and refresh the page.</p><button onclick="location.reload()" style="padding:10px 20px;font-size:16px;cursor:pointer;">ğŸ”„ Refresh Page</button></div>';
            } else {
                console.log('HanziWriter loaded from CDN successfully');
            }
        });
    </script>
</head>
<body>
    <div class="game-container">
        <!-- Header with stats -->
        <header class="game-header">
            <div class="player-stats">
                <div class="stat">
                    <span class="stat-label">Level:</span>
                    <span id="player-level">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">XP:</span>
                    <span id="player-xp">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Characters:</span>
                    <span id="character-count">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Items:</span>
                    <span id="item-count">0</span>
                </div>
            </div>
            <div class="game-controls">
                <button id="items-btn" class="pixel-btn items-btn" title="View and use items">ğŸ’ Items</button>
                <button id="battle-btn" class="pixel-btn battle-btn" title="Battle wild characters and phrases!">âš”ï¸ Battle</button>
                
                <!-- File Operations Dropdown -->
                <div class="dropdown">
                    <button id="file-menu-btn" class="pixel-btn dropdown-btn" title="File operations">ğŸ’¾ File</button>
                    <div class="dropdown-content">
                        <button id="save-btn" class="dropdown-item" title="Save to browser (auto-saves anyway)">ğŸ’¾ Save</button>
                        <button id="export-btn" class="dropdown-item" title="Download backup file">ğŸ“¤ Export</button>
                        <button id="load-btn" class="dropdown-item" title="Load from backup file">ğŸ“¥ Load</button>
                    </div>
                </div>
                
                <!-- Settings Dropdown -->
                <div class="dropdown">
                    <button id="settings-menu-btn" class="pixel-btn dropdown-btn" title="Game settings">âš™ï¸ Settings</button>
                    <div class="dropdown-content">
                        <button id="instructions-btn" class="dropdown-item" title="How to play the game">ğŸ“– Instructions</button>
                        <button id="manage-btn" class="dropdown-item" title="Manage characters and data">ğŸ€„ Manage Data</button>
                        <button id="game-reset-btn" class="dropdown-item reset-btn" title="Reset all game data (cannot be undone!)">ğŸ—‘ï¸ Reset Game</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main game area -->
        <main class="game-main">
            <!-- Character selection screen -->
            <div id="character-select" class="screen active">
                <h2>Choose a Character to Practice</h2>
                <div id="loading-indicator" class="loading-message">
                    <div class="loading-spinner"></div>
                    <p>Loading Hanzi Creatures...</p>
                </div>
                <div id="character-grid" class="character-grid" style="display: none;">
                    <!-- Characters will be dynamically loaded here -->
                </div>
                <button id="add-character-btn" class="pixel-btn" style="display: none;">Add New Character</button>
            </div>

            <!-- Practice screen -->
            <div id="practice-screen" class="screen">
                <div class="practice-header">
                    <button id="back-btn" class="pixel-btn">â† Back</button>
                    <div class="current-character-info">
                        <h3 id="current-character-name">ä½ </h3>
                        <div class="character-stats">
                            <span>Level: <span id="char-level">1</span></span>
                            <span>XP: <span id="char-xp">0/100</span></span>
                            <span>HP: <span id="char-hp">20</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="practice-area">
                    <!-- Hanzi writing area -->
                    <div id="hanzi-writer" class="hanzi-container"></div>
                    
                    <!-- Practice controls -->
                    <div class="practice-controls">
                        <button id="hint-btn" class="pixel-btn">Show Hint</button>
                        <button id="reset-btn" class="pixel-btn">Reset</button>
                        <button id="next-btn" class="pixel-btn">Next Practice</button>
                    </div>
                </div>

                <!-- XP feedback -->
                <div id="xp-feedback" class="xp-feedback hidden">
                    <div class="xp-gained">+<span id="xp-amount">0</span> XP!</div>
                    <div class="accuracy">Accuracy: <span id="accuracy-percent">0</span>%</div>
                </div>
            </div>

            <!-- Character management screen -->
            <div id="manage-screen" class="screen">
                <h2>Manage Game</h2>
                
                <!-- Data Management Section -->
                <div class="manage-section">
                    <h3>ğŸ“š Game Data</h3>
                    <div class="data-status" id="data-status">
                        <p>Current Data Source: <span id="current-data-source">Built-in</span></p>
                        <p>Characters: <span id="data-char-count">0</span> | Phrases: <span id="data-phrase-count">0</span></p>
                    </div>
                    
                    <div class="data-controls">
                        <div class="upload-area" id="upload-area">
                            <div class="upload-content">
                                <div class="upload-icon">ğŸ“</div>
                                <p>Drop JSON files here or <button class="link-btn" id="browse-files">browse files</button></p>
                                <small>Supports character data, phrase data, or combined JSON files</small>
                            </div>
                            <input type="file" id="file-input" accept=".json" multiple style="display: none;">
                        </div>
                        
                        <div class="data-buttons">
                            <button id="switch-to-builtin" class="pixel-btn" title="Use built-in game data">ğŸ“¦ Use Built-in Data</button>
                            <button id="switch-to-custom" class="pixel-btn" title="Use your custom uploaded data" disabled>ğŸ“ Use Custom Data</button>
                            <button id="export-custom-data" class="pixel-btn" title="Download your custom data as JSON">ğŸ’¾ Export Custom Data</button>
                            <button id="clear-custom-data" class="pixel-btn warning-btn" title="Delete all custom data">ğŸ—‘ï¸ Clear Custom Data</button>
                            <button id="show-examples" class="pixel-btn" title="Show example JSON formats">ğŸ“‹ Show Examples</button>
                        </div>
                    </div>
                </div>

                <!-- Character Management Section -->
                <div class="manage-section">
                    <h3>ğŸ€„ Character Management</h3>
                    <div class="manage-controls">
                        <div class="input-row">
                            <input type="text" id="new-character-input" placeholder="Character (e.g., ä½ )" maxlength="1">
                            <input type="text" id="new-pinyin-input" placeholder="Pinyin (e.g., nÇ)" maxlength="10">
                        </div>
                        <button id="add-char-btn" class="pixel-btn">Add Character</button>
                    </div>
                    <div id="manage-grid" class="character-grid">
                        <!-- Managed characters will appear here -->
                    </div>
                </div>

                <button id="back-to-select" class="pixel-btn">Back to Game</button>
            </div>

            <!-- Evolution/Phrase screen -->
            <div id="evolution-screen" class="screen">
                <h2>Create Phrases</h2>
                <div id="available-phrases" class="phrase-grid">
                    <!-- Available phrase combinations will appear here -->
                </div>
                <button id="back-from-evolution" class="pixel-btn">Back</button>
            </div>

            <!-- Items/Bag screen -->
            <div id="items-screen" class="screen">
                <h2>Items Bag</h2>
                <div class="items-info">
                    <p>Use items to boost your characters' XP and help them level up faster!</p>
                </div>
                <div id="items-grid" class="items-grid">
                    <!-- Items will be displayed here -->
                </div>
                <button id="items-back-btn" class="pixel-btn">â† Back</button>
            </div>

            <!-- Battle screen -->
            <div id="battle-screen" class="screen">
                <h2>Battle Arena</h2>
                
                <!-- Battle area -->
                <div class="battle-area">
                    <!-- Player side -->
                    <div class="battle-side player-side">
                        <h3>Your Character</h3>
                        <div id="player-character" class="battle-character">
                            <!-- Player character will be displayed here -->
                        </div>
                        <div id="player-team" class="character-team">
                            <!-- Other available characters for switching -->
                        </div>
                    </div>

                    <!-- VS indicator -->
                    <div class="battle-vs">
                        <div class="vs-text">VS</div>
                        <button id="attack-btn" class="pixel-btn attack-btn">Attack!</button>
                    </div>

                    <!-- Enemy side -->
                    <div class="battle-side enemy-side">
                        <h3>Wild Character</h3>
                        <div id="enemy-character" class="battle-character">
                            <!-- Enemy character will be displayed here -->
                        </div>
                    </div>
                </div>

                <!-- Battle log -->
                <div class="battle-log">
                    <h4>Battle Log</h4>
                    <div id="battle-messages" class="battle-messages">
                        <!-- Battle messages will appear here -->
                    </div>
                </div>

                <!-- Battle controls -->
                <div class="battle-controls">
                    <button id="battle-back-btn" class="pixel-btn">â† Back to Practice</button>
                    <button id="find-opponent-btn" class="pixel-btn">Find New Opponent</button>
                </div>
            </div>

            <!-- Instructions screen -->
            <div id="instructions-screen" class="screen">
                <h2>ğŸ“– How to Play Hanzi Creatures</h2>
                
                <div class="instructions-content">
                    <div class="instruction-section">
                        <h3>ğŸ¯ Game Overview</h3>
                        <p><strong>Hanzi Creatures</strong> is a Chinese character learning game that combines writing practice with RPG-style progression. Train your characters by practicing writing, unlock new phrases, collect items, and battle wild characters!</p>
                    </div>

                    <div class="instruction-section">
                        <h3>âœï¸ Character Practice</h3>
                        <ul>
                            <li><strong>Select a character</strong> from the main screen to start practicing</li>
                            <li><strong>Draw strokes</strong> in the correct order on the practice area</li>
                            <li><strong>Use hints</strong> to see just the next stroke you need to draw</li>
                            <li><strong>Earn XP</strong> based on accuracy and speed</li>
                            <li><strong>Level up</strong> characters to increase their combat stats</li>
                        </ul>
                    </div>

                    <div class="instruction-section">
                        <h3>ğŸŒ± Character Growth</h3>
                        <div class="stat-explanation">
                            <div class="stat-item">
                                <strong>Level:</strong> Increases with XP, improves all stats
                            </div>
                            <div class="stat-item">
                                <strong>HP (Health Points):</strong> Character's battle endurance
                            </div>
                            <div class="stat-item">
                                <strong>ATK (Attack):</strong> Damage dealt in battles
                            </div>
                            <div class="stat-item">
                                <strong>DEF (Defense):</strong> Damage reduction in battles
                            </div>
                            <div class="stat-item">
                                <strong>Accuracy:</strong> Your writing skill (affects XP gained)
                            </div>
                        </div>
                    </div>

                    <div class="instruction-section">
                        <h3>ğŸ“œ Phrases & Evolution</h3>
                        <ul>
                            <li><strong>Level up characters</strong> to unlock phrase combinations</li>
                            <li><strong>Visit "Create Phrases"</strong> to practice multi-character sequences</li>
                            <li><strong>Complete phrases</strong> to turn them into powerful phrase characters</li>
                            <li><strong>Phrase characters</strong> have enhanced stats and can be used in battle</li>
                        </ul>
                    </div>

                    <div class="instruction-section">
                        <h3>âš”ï¸ Battle System</h3>
                        <ul>
                            <li><strong>Unlock battles</strong> by completing 10 practice sessions</li>
                            <li><strong>Choose up to 6 characters</strong> for your battle team</li>
                            <li><strong>Attack enemies</strong> and switch between team members</li>
                            <li><strong>Defeat opponents</strong> to capture new characters and find items</li>
                            <li><strong>Battle completion</strong> locks battles until you practice 10 more times</li>
                        </ul>
                    </div>

                    <div class="instruction-section">
                        <h3>ğŸ’ Items & Inventory</h3>
                        <ul>
                            <li><strong>Find items</strong> by defeating enemies in battles</li>
                            <li><strong>Use XP boost items</strong> to help characters level up faster</li>
                            <li><strong>Select a character</strong> when using items to apply the effect</li>
                            <li><strong>Items stack</strong> - collect multiples of the same type</li>
                        </ul>
                    </div>

                    <div class="instruction-section">
                        <h3>ğŸ€„ Character Management</h3>
                        <ul>
                            <li><strong>Add new characters</strong> by typing them in the Manage Data screen</li>
                            <li><strong>Provide pinyin</strong> pronunciation for custom characters</li>
                            <li><strong>Upload custom data</strong> with JSON files for advanced users</li>
                            <li><strong>Remove characters</strong> you no longer want to practice</li>
                        </ul>
                    </div>

                    <div class="instruction-section">
                        <h3>ğŸ’¾ Save & Progress</h3>
                        <ul>
                            <li><strong>Auto-save:</strong> Game saves automatically to your browser</li>
                            <li><strong>Export:</strong> Download a backup file to keep your progress</li>
                            <li><strong>Load:</strong> Upload a backup file to restore your game</li>
                            <li><strong>Reset:</strong> Start over completely (cannot be undone!)</li>
                        </ul>
                    </div>

                    <div class="instruction-section">
                        <h3>ğŸ’¡ Tips for Success</h3>
                        <div class="tips-grid">
                            <div class="tip-item">
                                <strong>ğŸ¯ Focus on Accuracy:</strong> Higher accuracy gives more XP
                            </div>
                            <div class="tip-item">
                                <strong>ğŸ“š Practice Regularly:</strong> Consistent practice unlocks battles
                            </div>
                            <div class="tip-item">
                                <strong>âš”ï¸ Battle Strategically:</strong> Level up characters before tough battles
                            </div>
                            <div class="tip-item">
                                <strong>ğŸ”® Create Phrases:</strong> Phrase characters are very powerful
                            </div>
                            <div class="tip-item">
                                <strong>ğŸ’ Use Items Wisely:</strong> Save XP boosts for difficult characters
                            </div>
                            <div class="tip-item">
                                <strong>ğŸ’¾ Export Often:</strong> Keep backups of your progress
                            </div>
                        </div>
                    </div>

                    <div class="instruction-section">
                        <h3>â“ Troubleshooting</h3>
                        <ul>
                            <li><strong>Characters not loading?</strong> Check your internet connection for the font library</li>
                            <li><strong>Strokes not working?</strong> Make sure to follow the correct stroke order</li>
                            <li><strong>Progress lost?</strong> Import your last exported backup file</li>
                            <li><strong>Battle locked?</strong> Complete more practice sessions to unlock</li>
                        </ul>
                    </div>
                </div>

                <button id="instructions-back-btn" class="pixel-btn">â† Back to Game</button>
            </div>
        </main>

        <!-- Character Selection Modal for Item Usage -->
        <div id="character-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Choose Character</h3>
                    <button id="modal-close" class="pixel-btn close-btn">âœ•</button>
                </div>
                <div class="modal-body">
                    <p id="modal-item-info">Select a character to use this item on:</p>
                    <div id="modal-character-grid" class="character-grid small">
                        <!-- Characters for selection will appear here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Battle Team Selection Modal -->
        <div id="team-selection-modal" class="modal hidden">
            <div class="modal-content large">
                <div class="modal-header">
                    <h3>âš”ï¸ Select Battle Team</h3>
                    <button id="team-modal-close" class="pixel-btn close-btn">âœ•</button>
                </div>
                <div class="modal-body">
                    <div class="team-selection-info">
                        <p>Choose up to 6 characters for battle. Click characters to add/remove them from your team.</p>
                        <div class="team-counter">
                            <span>Team: </span>
                            <span id="selected-count">0</span>
                            <span>/</span>
                            <span id="max-count">6</span>
                        </div>
                    </div>
                    
                    <div class="selected-team">
                        <h4>Selected Team:</h4>
                        <div id="selected-team-grid" class="character-grid small">
                            <!-- Selected characters appear here -->
                        </div>
                    </div>
                    
                    <div class="available-characters">
                        <h4>Available Characters:</h4>
                        <div id="available-team-grid" class="character-grid small">
                            <!-- Available characters appear here -->
                        </div>
                    </div>
                    
                    <div class="team-selection-buttons">
                        <button id="start-battle-btn" class="pixel-btn battle-btn" disabled>Start Battle!</button>
                        <button id="cancel-team-btn" class="pixel-btn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- JSON Examples Modal -->
        <div id="examples-modal" class="modal hidden">
            <div class="modal-content large">
                <div class="modal-header">
                    <h3>ğŸ“‹ JSON Format Examples</h3>
                    <button id="examples-modal-close" class="pixel-btn close-btn">âœ•</button>
                </div>
                <div class="modal-body">
                    <p>Use these formats to create your own character and phrase data files:</p>
                    
                    <div class="example-section">
                        <h4>Character Data Format</h4>
                        <pre id="character-example" class="json-example"></pre>
                        <button class="pixel-btn small-btn" id="download-char-example">ğŸ“¥ Download Example</button>
                    </div>
                    
                    <div class="example-section">
                        <h4>Phrase Data Format</h4>
                        <pre id="phrase-example" class="json-example"></pre>
                        <button class="pixel-btn small-btn" id="download-phrase-example">ğŸ“¥ Download Example</button>
                    </div>
                    
                    <div class="example-section">
                        <h4>Combined Data Format</h4>
                        <pre id="combined-example" class="json-example"></pre>
                        <button class="pixel-btn small-btn" id="download-combined-example">ğŸ“¥ Download Example</button>
                    </div>
                    
                    <div class="example-info">
                        <h4>Field Descriptions:</h4>
                        <ul>
                            <li><strong>pinyin</strong>: Pronunciation (required)</li>
                            <li><strong>strokes</strong>: Number of strokes (1-30, required)</li>
                            <li><strong>difficulty</strong>: Difficulty level (1-5, required)</li>
                            <li><strong>frequency</strong>: Usage frequency (0-100, required)</li>
                            <li><strong>characters</strong>: Array of characters in phrase (required for phrases)</li>
                            <li><strong>requirements</strong>: Character level requirements (required for phrases)</li>
                            <li><strong>meaning</strong>: English meaning (required for phrases)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="practice-tracker.js"></script>
    <script src="practice-ui.js"></script>
    <script src="game-data.js"></script>
    <script src="data-manager.js"></script>
    <script src="game-engine.js"></script>
    <script src="game-ui.js"></script>
    <script src="main.js"></script>
</body>
</html>
